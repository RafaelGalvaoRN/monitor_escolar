import os
from utils import fragmenta_csv_por_faixas, rename_move, \
    save_csv, cleanup_paths, ensure_csv_local, normalize_timestamp_column
import pandas as pd


if __name__ == '__main__':

    # file_path = r"C:\Users\User\Downloads\Projeto Monitor Escolar (teste).csv (1).zip"
    # novo_arquivo = rename_move(file_path, "projeto_monitor.csv", "../data")
    # print("Arquivo movido para:", novo_arquivo)

    # 1) Garantir CSV local (lida com .zip ou .csv)
    src_path = r"C:\Users\User\Downloads"
    csv_local, to_clean = ensure_csv_local(src_path)

    try:
        # 2) Ler e transformar
        df = pd.read_csv(csv_local, dtype=str)
        df = normalize_timestamp_column(df, src_col="Carimbo de data/hora", dst_col="Data do Envio")

        # 3) Salvar no destino com novo nome
        dest_path = os.path.join("../data", "projeto_monitor.csv")
        save_csv(df, dest_path)
        print("CSV corrigido e salvo em:", dest_path)

    finally:
        # 4) Limpar temporários (se extraiu de ZIP)
        cleanup_paths(to_clean)

    #
    # df = pd.read_csv("data/projeto_monitor.csv")
    # num_cols = df.shape[1]
    # print(f"CSV tem {num_cols} colunas (índices 0 a {num_cols - 1})")

    # Faixas corrigidas baseadas na estrutura real do CSV
    result = fragmenta_csv_por_faixas(
        "../data/projeto_monitor.csv",
        {
            "Identificacao_Escola": (0, 16),  # Eixo 1
            "Estrutura_Fisica_Funcionamento": (17, 64),  # Eixo 2
            "Alunos": (65, 85),  # Eixo 3
            "Professores": (86, 90),  # Eixo 4
            "Gestao_Equipe": (91, 98),  # Eixo 5
            "Pais_Comunidade": (99, 104),  # Eixo 6
            "Questoes_Pedagogicas": (105, 108),  # Eixo 7
            "Gestao_Democratica": (109, 116),  # Eixo 8
            "Documentos": (117, 119),  # Eixo 9
            "Seguranca_Escola": (120, 122),  # Eixo 10
            "Violencia_Indisciplina": (123, 125),  # Eixo 11
            "Prestacao_Contas": (126, 135),  # Eixo 12
            "Experiencia_Inovadora": (136, 137),  # Eixo 13
            "Objetivo_Gestao": (138, 140),  # Eixo 14
        },
        salvar=True,
        prefixo_arquivo="eixo_",
        pasta_destino="../data/",
    )

    print("Fragmentação concluída com sucesso!")
    print(f"Foram criados {len(result)} arquivos CSV na pasta 'data/'")

    # # Opcionalmente, mostrar info sobre cada fragmento
    # for nome_eixo, df in result.items():
    #     print(f"{nome_eixo}: {df.shape[1]} colunas, {df.shape[0]} linhas")

    # import pandas as pd
    #
    # # Vamos ver todas as 23 colunas do seu CSV
    # df = pd.read_csv("dados_escolares.csv")
    #
    # print(f"CSV tem {df.shape[1]} colunas:")
    # print("=" * 60)
    #
    # for i, col in enumerate(df.columns):
    #     print(f"[{i:2d}] {col}")
    #
    # print("=" * 60)
    # print(f"Dados disponíveis: {df.shape[0]} linha(s)")
    #
    # # Vamos também ver um exemplo dos dados
    # print("\nPrimeira linha de dados (primeiros 5 valores):")
    # print(df.iloc[0, :5].tolist())